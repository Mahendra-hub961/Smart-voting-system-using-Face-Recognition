<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Upload Face - Smart Voting System</title>
<link rel="stylesheet" href="/static/gov.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-4">

    <!-- Header -->
    <div class="gov-header d-flex align-items-center mb-3">
        <img src="/static/logo.png" class="gov-logo" alt="">
        <div class="ms-2">
            <h1 class="gov-title mb-0">Smart Voting System</h1>
            <p class="gov-sub mb-0">Upload / Capture Your Face</p>
        </div>
    </div>

    <div class="gov-tricolor mb-4">
        <div class="stripe saffron"></div>
        <div class="stripe white"></div>
        <div class="stripe green"></div>
    </div>

    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <!-- Option 1: Upload File -->
    <div class="card card-official mb-4 p-3">
        <h5>Option 1: Upload Photo</h5>
        <form method="POST" action="/save_face" enctype="multipart/form-data">
            <input type="hidden" name="voter_id" value="{{ voter_id }}">
            <div class="mb-3">
                <input type="file" name="photo" class="form-control" accept="image/*">
            </div>
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>
    </div>

    <!-- Option 2: Capture Live Camera -->
    <div class="card card-official mb-4 p-3">
        <h5>Option 2: Capture from Camera</h5>
        <video id="video" width="320" height="240" autoplay class="border rounded mb-3"></video><br>
        <button id="captureBtn" class="btn btn-primary mb-3">Capture & Submit</button>

        <form id="camForm" method="POST" action="/save_face">
            <input type="hidden" name="voter_id" value="{{ voter_id }}">
            <input type="hidden" id="captured_image" name="captured_image">
        </form>
    </div>

</div>

<script>
const video = document.getElementById("video");
const captureBtn = document.getElementById("captureBtn");
const camForm = document.getElementById("camForm");
const capturedInput = document.getElementById("captured_image");

// Initialize camera
async function initCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
    } catch (err) {
        alert("Camera not available or permission denied: " + err);
        console.error(err);
    }
}

// Capture image
captureBtn.addEventListener("click", function() {
    if (!video.srcObject) {
        alert("Camera not initialized");
        return;
    }
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);
    const data = canvas.toDataURL("image/jpeg");
    capturedInput.value = data;
    camForm.submit();
});

// Start camera on page load
window.addEventListener("load", initCamera);
</script>

</body>
</html>
